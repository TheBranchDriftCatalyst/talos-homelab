# Traefik Helm Chart Values
# For single-node homelab setup

# Global settings
deployment:
  kind: DaemonSet  # Use DaemonSet for hostPort binding
  replicas: 1

# Service configuration
service:
  enabled: true
  type: ClusterIP

# Ports configuration
ports:
  web:
    port: 80
    exposedPort: 80
    protocol: TCP
    hostPort: 80  # Bind to host port 80
  websecure:
    port: 443
    exposedPort: 443
    protocol: TCP
    hostPort: 443  # Bind to host port 443
  traefik:
    port: 9000
    exposedPort: 9000
    protocol: TCP

# Enable dashboard
ingressRoute:
  dashboard:
    enabled: true
    matchRule: Host(`traefik.lab`)
    entryPoints: ["web"]

# Enable access logs
logs:
  general:
    level: INFO
  access:
    enabled: true

# Providers
providers:
  kubernetesCRD:
    enabled: true
    allowCrossNamespace: true
    allowExternalNameServices: true
  kubernetesIngress:
    enabled: true
    publishedService:
      enabled: false

# Additional arguments
additionalArguments:
  - --serversTransport.insecureSkipVerify=true  # For self-signed certs
  - --api.insecure=true  # Enable insecure API (homelab only)
  - --api.dashboard=true

# Security context - needed for hostPort
securityContext:
  capabilities:
    drop: [ALL]
    add: [NET_BIND_SERVICE]
  readOnlyRootFilesystem: false
  runAsGroup: 0
  runAsNonRoot: false
  runAsUser: 0

podSecurityContext:
  fsGroup: 0
  runAsUser: 0
  runAsNonRoot: false

# Resources
resources:
  requests:
    cpu: 100m
    memory: 50Mi
  limits:
    cpu: 300m
    memory: 150Mi

# Enable Prometheus metrics
metrics:
  prometheus:
    enabled: true
    entryPoint: metrics

# Pod labels
podLabels:
  app: traefik

# Namespace labels for pod security
namespaceOverride: "traefik"
