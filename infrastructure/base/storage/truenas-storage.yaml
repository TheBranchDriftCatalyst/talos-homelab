---
# TrueNAS NFS Storage Configuration
# Static PVs and PVCs for media libraries and downloads
#
# Variables substituted via Flux postBuild from cluster-settings ConfigMap:
#   ${TRUENAS_IP} - TrueNAS server IP
#   ${TRUENAS_POOL} - Base pool path (e.g., /mnt/tank)

# ============================================================================
# Storage Class
# ============================================================================
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: truenas-nfs
  annotations:
    storageclass.kubernetes.io/is-default-class: "false"
provisioner: kubernetes.io/no-provisioner
reclaimPolicy: Retain
volumeBindingMode: Immediate

---
# ============================================================================
# PERSISTENT VOLUMES - Media Library
# ============================================================================
apiVersion: v1
kind: PersistentVolume
metadata:
  name: truenas-media-movies
  labels:
    type: truenas-nfs
    media-type: movies
spec:
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: truenas-nfs
  capacity:
    storage: 50Ti
  mountOptions:
    - hard
    - nfsvers=3
    - noatime
    - nodiratime
    - rsize=1048576
    - wsize=1048576
  nfs:
    server: "${TRUENAS_IP}"
    path: "${TRUENAS_POOL}/media/movies"

---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: truenas-media-tv
  labels:
    type: truenas-nfs
    media-type: tv
spec:
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: truenas-nfs
  capacity:
    storage: 50Ti
  mountOptions:
    - hard
    - nfsvers=3
    - noatime
    - nodiratime
    - rsize=1048576
    - wsize=1048576
  nfs:
    server: "${TRUENAS_IP}"
    path: "${TRUENAS_POOL}/media/tv"

---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: truenas-media-music
  labels:
    type: truenas-nfs
    media-type: music
spec:
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: truenas-nfs
  capacity:
    storage: 2Ti
  mountOptions:
    - hard
    - nfsvers=3
    - noatime
    - nodiratime
    - rsize=1048576
    - wsize=1048576
  nfs:
    server: "${TRUENAS_IP}"
    path: "${TRUENAS_POOL}/media/music"

---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: truenas-media-books
  labels:
    type: truenas-nfs
    media-type: books
spec:
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: truenas-nfs
  capacity:
    storage: 500Gi
  mountOptions:
    - hard
    - nfsvers=3
    - noatime
    - nodiratime
    - rsize=1048576
    - wsize=1048576
  nfs:
    server: "${TRUENAS_IP}"
    path: "${TRUENAS_POOL}/media/books"

---
# ============================================================================
# PERSISTENT VOLUMES - Downloads
# ============================================================================
apiVersion: v1
kind: PersistentVolume
metadata:
  name: truenas-downloads-complete
  labels:
    type: truenas-nfs
    download-type: complete
spec:
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: truenas-nfs
  capacity:
    storage: 1Ti
  mountOptions:
    - hard
    - nfsvers=3
    - noatime
    - nodiratime
    - rsize=1048576
    - wsize=1048576
  nfs:
    server: "${TRUENAS_IP}"
    path: "${TRUENAS_POOL}/downloads/complete"

---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: truenas-downloads-incomplete
  labels:
    type: truenas-nfs
    download-type: incomplete
spec:
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: truenas-nfs
  capacity:
    storage: 500Gi
  mountOptions:
    - hard
    - nfsvers=3
    - noatime
    - nodiratime
    - rsize=1048576
    - wsize=1048576
  nfs:
    server: "${TRUENAS_IP}"
    path: "${TRUENAS_POOL}/downloads/incomplete"

---
# ============================================================================
# PERSISTENT VOLUME CLAIMS - media namespace
# ============================================================================
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: truenas-movies
  namespace: media
  labels:
    app.kubernetes.io/component: media-storage
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: truenas-nfs
  volumeName: truenas-media-movies
  resources:
    requests:
      storage: 50Ti

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: truenas-tv
  namespace: media
  labels:
    app.kubernetes.io/component: media-storage
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: truenas-nfs
  volumeName: truenas-media-tv
  resources:
    requests:
      storage: 50Ti

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: truenas-music
  namespace: media
  labels:
    app.kubernetes.io/component: media-storage
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: truenas-nfs
  volumeName: truenas-media-music
  resources:
    requests:
      storage: 2Ti

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: truenas-books
  namespace: media
  labels:
    app.kubernetes.io/component: media-storage
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: truenas-nfs
  volumeName: truenas-media-books
  resources:
    requests:
      storage: 500Gi

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: truenas-downloads-complete
  namespace: media
  labels:
    app.kubernetes.io/component: download-storage
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: truenas-nfs
  volumeName: truenas-downloads-complete
  resources:
    requests:
      storage: 1Ti

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: truenas-downloads-incomplete
  namespace: media
  labels:
    app.kubernetes.io/component: download-storage
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: truenas-nfs
  volumeName: truenas-downloads-incomplete
  resources:
    requests:
      storage: 500Gi
