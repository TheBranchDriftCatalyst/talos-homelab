---
# Synology NAS NFS Storage Configuration
# Static PVs and PVCs for media libraries and downloads ONLY
# (App configs/appdata use separate dynamic provisioning via fatboy-nfs-appdata)
#
# Variables substituted via Flux postBuild from cluster-settings ConfigMap:
#   ${SYNOLOGY_IP} - Synology NAS IP
#   ${SYNOLOGY_VOLUME} - Base volume path (e.g., /volume1)

# ============================================================================
# Storage Class
# ============================================================================
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: synology-nfs
  annotations:
    storageclass.kubernetes.io/is-default-class: "false"
provisioner: kubernetes.io/no-provisioner
reclaimPolicy: Retain
volumeBindingMode: Immediate

---
# ============================================================================
# PERSISTENT VOLUMES - Media Library
# ============================================================================
apiVersion: v1
kind: PersistentVolume
metadata:
  name: synology-media-movies
  labels:
    type: synology-nfs
    media-type: movies
spec:
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: synology-nfs
  capacity:
    storage: 10Ti
  mountOptions:
    - hard
    - nfsvers=4.1
    - noatime
    - nodiratime
    - rsize=1048576
    - wsize=1048576
  nfs:
    server: "${SYNOLOGY_IP}"
    path: "${SYNOLOGY_VOLUME}/media/movies"

---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: synology-media-tv
  labels:
    type: synology-nfs
    media-type: tv
spec:
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: synology-nfs
  capacity:
    storage: 10Ti
  mountOptions:
    - hard
    - nfsvers=4.1
    - noatime
    - nodiratime
    - rsize=1048576
    - wsize=1048576
  nfs:
    server: "${SYNOLOGY_IP}"
    path: "${SYNOLOGY_VOLUME}/media/tv"

---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: synology-media-music
  labels:
    type: synology-nfs
    media-type: music
spec:
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: synology-nfs
  capacity:
    storage: 2Ti
  mountOptions:
    - hard
    - nfsvers=4.1
    - noatime
    - nodiratime
    - rsize=1048576
    - wsize=1048576
  nfs:
    server: "${SYNOLOGY_IP}"
    path: "${SYNOLOGY_VOLUME}/media/music"

---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: synology-media-books
  labels:
    type: synology-nfs
    media-type: books
spec:
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: synology-nfs
  capacity:
    storage: 500Gi
  mountOptions:
    - hard
    - nfsvers=4.1
    - noatime
    - nodiratime
    - rsize=1048576
    - wsize=1048576
  nfs:
    server: "${SYNOLOGY_IP}"
    path: "${SYNOLOGY_VOLUME}/media/books"

---
# ============================================================================
# PERSISTENT VOLUMES - Downloads
# ============================================================================
apiVersion: v1
kind: PersistentVolume
metadata:
  name: synology-downloads-complete
  labels:
    type: synology-nfs
    download-type: complete
spec:
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: synology-nfs
  capacity:
    storage: 1Ti
  mountOptions:
    - hard
    - nfsvers=4.1
    - noatime
    - nodiratime
    - rsize=1048576
    - wsize=1048576
  nfs:
    server: "${SYNOLOGY_IP}"
    path: "${SYNOLOGY_VOLUME}/downloads/complete"

---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: synology-downloads-incomplete
  labels:
    type: synology-nfs
    download-type: incomplete
spec:
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: synology-nfs
  capacity:
    storage: 500Gi
  mountOptions:
    - hard
    - nfsvers=4.1
    - noatime
    - nodiratime
    - rsize=1048576
    - wsize=1048576
  nfs:
    server: "${SYNOLOGY_IP}"
    path: "${SYNOLOGY_VOLUME}/downloads/incomplete"

---
# ============================================================================
# PERSISTENT VOLUME CLAIMS - media namespace
# ============================================================================
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: synology-movies
  namespace: media
  labels:
    app.kubernetes.io/component: media-storage
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: synology-nfs
  volumeName: synology-media-movies
  resources:
    requests:
      storage: 10Ti

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: synology-tv
  namespace: media
  labels:
    app.kubernetes.io/component: media-storage
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: synology-nfs
  volumeName: synology-media-tv
  resources:
    requests:
      storage: 10Ti

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: synology-music
  namespace: media
  labels:
    app.kubernetes.io/component: media-storage
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: synology-nfs
  volumeName: synology-media-music
  resources:
    requests:
      storage: 2Ti

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: synology-books
  namespace: media
  labels:
    app.kubernetes.io/component: media-storage
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: synology-nfs
  volumeName: synology-media-books
  resources:
    requests:
      storage: 500Gi

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: synology-downloads-complete
  namespace: media
  labels:
    app.kubernetes.io/component: download-storage
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: synology-nfs
  volumeName: synology-downloads-complete
  resources:
    requests:
      storage: 1Ti

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: synology-downloads-incomplete
  namespace: media
  labels:
    app.kubernetes.io/component: download-storage
spec:
  accessModes:
    - ReadWriteMany
  storageClassName: synology-nfs
  volumeName: synology-downloads-incomplete
  resources:
    requests:
      storage: 500Gi
