apiVersion: v1
kind: ConfigMap
metadata:
  name: nebula-config
  namespace: nebula-mesh
data:
  config.yaml: |
    pki:
      ca: /etc/nebula/ca.crt
      cert: /etc/nebula/host.crt
      key: /etc/nebula/host.key

    static_host_map:
      "10.100.1.1": ["44.246.126.127:4242"]

    lighthouse:
      am_lighthouse: false
      interval: 60
      hosts:
        - "10.100.1.1"

    listen:
      host: 0.0.0.0
      port: 4243

    punchy:
      punch: true
      respond: true

    relay:
      am_relay: false
      use_relays: true

    tun:
      disabled: false
      dev: nebula0
      mtu: 1300
      # Route traffic to k3s cluster through lighthouse
      unsafe_routes:
        - route: 10.42.0.0/16
          via: 10.100.1.1
        - route: 10.43.0.0/16
          via: 10.100.1.1
        - route: 172.31.0.0/16
          via: 10.100.1.1

    firewall:
      outbound_action: drop
      inbound_action: drop

      conntrack:
        tcp_timeout: 12m
        udp_timeout: 3m
        default_timeout: 10m

      outbound:
        - port: any
          proto: any
          host: any

      inbound:
        - port: any
          proto: icmp
          host: any
        - port: any
          proto: any
          group: infrastructure
        - port: any
          proto: any
          group: lighthouse

    logging:
      level: info
      format: text
